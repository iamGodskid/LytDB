const fs = require("fs");
module.exports=function(opt) {
    // Start with an object to hold the top-level fields
    let uri=opt
    let result = {};
    let section = result;
    let invalid=!/^\s*(!._*)?$/
    var xml;
    let verify=/^<@GINI@>/gi
    
    if(typeof uri !== "string") throw Error("file path is not string"+" "+typeof uri+" given")
    
    this.parse=function(){
    fs.readFile(uri, "utf-8", function(data, err){
       
      if(data){
      var string=data;
    if(verify.test(string)){
      string.replace(verify, "")
    }
    string.split(/\r?\n/).forEach(line => {
    let match;
    if (match = line.match(/^(\w+)=(.*)$/)) {
    section[match[1]] = match[2];
    } else if (match = line.match(/^\[(.*)\]$/)) {
    section = result[match[1]] = {};
    } 
    
    else if (!/^\s*(!._*)?$/.test(line)) {
    line.replace(invalid, "");
    }
  })
    return JSON.stringify(result);
    }else{
      return "parser failure";
    }
      
  })
    }
    }
    